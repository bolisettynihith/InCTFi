FROM ubuntu:18.04

LABEL MAINTAINER  Abhishek S  <abhiabhi2306@gmail.com>

RUN apt update; apt -y --autoremove full-upgrade
ARG DEBIAN_FRONTEND=noninteractive
RUN apt install sudo apache2 php7.2 netcat python3 wget openssl curl cron -y

RUN apt-get autoremove

COPY index.php /var/www/html/debug/index.php
COPY debugreq.php /var/www/html/debug/
COPY index.html /var/www/html/
COPY start.sh /root/start.sh
COPY environment.env /var/www/
COPY asdf.py /usr/bin/logsplit
COPY flag.txt /root/flag_8753874659347865934.txt

RUN bash -c "useradd -m webuser -s /bin/bash"
RUN usermod --password $(echo rootmeh999 | openssl passwd -1 -stdin) root
RUN chmod 705 /usr/bin/logsplit
RUN chmod 777 /var/www/environment.env

RUN echo "* * * * * root /usr/bin/logsplit >> /var/log/cron.log 2>&1" > /etc/cron.d/backup

COPY apache2.conf /etc/apache2/apache2.conf
RUN sed -i -r "s/APACHE_RUN_USER=www-data/APACHE_RUN_USER=webuser/g" /etc/apache2/envvars
RUN sed -i -r "s/APACHE_RUN_GROUP=www-data/APACHE_RUN_GROUP=webuser/g" /etc/apache2/envvars

RUN chmod -R 777 /var/www/html

EXPOSE 8080

ENTRYPOINT [ "bash", "/root/start.sh"]
